@namespace Blatternfly.Components
@inherits BaseComponent
@implements IAsyncDisposable
@inject IPortalConnector Connector

@code {
  [Parameter] public EventCallback OnConnect { get; set; }
  [Parameter] public EventCallback OnDisconnect { get; set; }

  [Parameter]
  public bool IsOpen
  {
    get => _isOpen;
    set
    {
      _isOpen = value;
      _ = _isOpen ? Connect() : Disconnect();
    }
  }

  public async ValueTask DisposeAsync()
  {
    if (Connector is not null)
    {
      await Connector.Disconnect();
      await OnDisconnect.InvokeAsync();
    }
  }

  private bool _isOpen;

  private async Task Connect()
  {
    await Connector.Connect(this);
    await OnConnect.InvokeAsync();
  }

  private async Task Disconnect()
  {
    await Connector.Disconnect();
    await OnDisconnect.InvokeAsync();
  }
}